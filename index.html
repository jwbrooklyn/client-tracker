<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script>
        function calculateTotal(element) {
            let row = element.closest("tr");
            let duration = parseFloat(row.cells[2].querySelector("select").value);
            let days = parseInt(row.cells[3].querySelector("select").value);
            let totalHours = duration * days;
            row.cells[4].querySelector("input").value = totalHours.toFixed(2);
            let weeksInMonth = new Date().getDate() > 28 ? 5 : 4;
            row.cells[5].querySelector("input").value = (totalHours * weeksInMonth).toFixed(2);
        }

        function downloadExcel() {
            let table = document.querySelector("table");
            let rows = table.querySelectorAll("tr");
            let data = [];

            let headers = [];
            rows[0].querySelectorAll("th").forEach(th => headers.push(th.innerText));
            data.push(headers);

            for (let i = 1; i < rows.length; i++) {
                let rowData = [];
                let cells = rows[i].querySelectorAll("td input, td select");
                
                cells.forEach(cell => {
                    if (cell.tagName === "SELECT") {
                        rowData.push(cell.options[cell.selectedIndex].text);
                    } else {
                        rowData.push(cell.value);
                    }
                });
                data.push(rowData);
            }

            let ws = XLSX.utils.aoa_to_sheet(data);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Client Data");
            XLSX.writeFile(wb, "Client_Tracker.xlsx");
            clearTable();
            alert("Your data has been exported to Excel. Please check your downloaded file.\nNote: The data is NOT saved online.");
        }

        function clearTable() {
            let table = document.querySelector("tbody");
            table.innerHTML = `
                <tr>
                    <td><input type="text" placeholder="Client Name"></td>
                    <td><input type="text" placeholder="Task"></td>
                    <td>
                        <select onchange="calculateTotal(this)">
                            <option value="0.25">15 minutes</option>
                            <option value="0.5">30 minutes</option>
                            <option value="0.75">45 minutes</option>
                            <option value="1">60 minutes</option>
                        </select>
                    </td>
                    <td>
                        <select onchange="calculateTotal(this)">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                        </select>
                    </td>
                    <td><input type="text" readonly></td>
                    <td><input type="text" readonly></td>
                    <td><button onclick="duplicateClient(this)">Duplicate</button></td>
                </tr>
            `;
        }

        function addClient() {
            let table = document.querySelector("tbody");
            let newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="Client Name"></td>
                <td><input type="text" placeholder="Task"></td>
                <td>
                    <select onchange="calculateTotal(this)">
                        <option value="0.25">15 minutes</option>
                        <option value="0.5">30 minutes</option>
                        <option value="0.75">45 minutes</option>
                        <option value="1">60 minutes</option>
                    </select>
                </td>
                <td>
                    <select onchange="calculateTotal(this)">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                </td>
                <td><input type="text" readonly></td>
                <td><input type="text" readonly></td>
                <td><button onclick="duplicateClient(this)">Duplicate</button></td>
            `;
        }

        function duplicateClient(button) {
            let row = button.closest("tr");
            let table = document.querySelector("tbody");
            let newRow = table.insertRow();

            row.querySelectorAll("td").forEach((cell, index) => {
                let newCell = newRow.insertCell(index);
                
                if (cell.querySelector("input")) {
                    let input = cell.querySelector("input");
                    let newInput = document.createElement("input");
                    newInput.type = "text";
                    newInput.value = input.value;
                    newInput.placeholder = input.placeholder;
                    newInput.readOnly = input.readOnly;
                    newCell.appendChild(newInput);
                } else if (cell.querySelector("select")) {
                    let select = cell.querySelector("select");
                    let newSelect = document.createElement("select");
                    
                    Array.from(select.options).forEach(option => {
                        let newOption = document.createElement("option");
                        newOption.value = option.value;
                        newOption.text = option.text;
                        newSelect.appendChild(newOption);
                    });

                    newSelect.value = select.value;
                    newSelect.setAttribute("onchange", "calculateTotal(this)");
                    newCell.appendChild(newSelect);
                } else {
                    newCell.innerHTML = cell.innerHTML;
                }
            });
        }
    </script>
</head>
<body>
    <h1>Client Tracker</h1>
    <button onclick="addClient()">New Client</button>
    <button onclick="downloadExcel()">Download Excel</button>
    <table border="1">
        <thead>
            <tr>
                <th>Client</th>
                <th>Task</th>
                <th>Duration</th>
                <th>Days Per Week</th>
                <th>Total Hours</th>
                <th>Monthly Total</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder="Client Name"></td>
                <td><input type="text" placeholder="Task"></td>
                <td>
                    <select onchange="calculateTotal(this)">
                        <option value="0.25">15 minutes</option>
                        <option value="0.5">30 minutes</option>
                        <option value="0.75">45 minutes</option>
                        <option value="1">60 minutes</option>
                    </select>
                </td>
                <td>
                    <select onchange="calculateTotal(this)">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                </td>
                <td><input type="text" readonly></td>
                <td><input type="text" readonly></td>
                <td><button onclick="duplicateClient(this)">Duplicate</button></td>
            </tr>
        </tbody>
    </table>
</body>
</html>
